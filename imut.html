<!DOCTYPE html> 
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="logorekammedis.ico">
<title>IMUT - Medical Record</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
:root{--blue:#1682a3}
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Verdana}
html,body{
  min-height:100vh;
  background:linear-gradient(150deg, #ffffff, #66a378);
  display:flex;
  flex-direction:column;
}

/* ===== HEADER ===== */
header{
  background:linear-gradient(150deg,#0fb2cf44,#1e5ea83f);
  padding:15px 20px;
  box-shadow:0 2px 10px rgba(0,0,0,.1);
  border-bottom:2px solid rgba(255,255,255,.8);
}
.logo img{width:300px;height:70px}

/* ===== NAV ===== */
nav ul{
  list-style:none;
  display:flex;
  flex-wrap:wrap;
  gap:5px;
  padding:10px;
  background:#fff;
  border-radius:50px;
  font-size:13px;
  justify-content:center;
  margin-top:15px;
  box-shadow:0 0 5px #0000004f;
}
nav ul li a{
  text-decoration:none;
  color:#3a3a3a;
  font-weight:bold;
  border-radius:50px;
  padding:5px 15px;
  display:flex;
  align-items:center;
  gap:5px;
  transition:.3s;
}
nav ul li a:hover{color:#116cb8}

/* ADMIN BUTTON */
.admin-btn{
  position:fixed;
  top:15px;
  right:20px;
  z-index:999;
  background:linear-gradient(135deg,#1653a3,#22c5b8);
  color:#fff;
  padding:8px 16px;
  border-radius:30px;
  font-size:12px;
  text-decoration:none;
  display:flex;
  align-items:center;
  gap:8px;
  box-shadow:0 5px 15px rgba(0,0,0,.25);
  transition:.3s;
}
.admin-btn:hover{transform:translateY(-2px)}

/* ===== CONTENT ===== */
main{flex:1;padding:30px 20px}
.content{
  max-width:1200px;
  margin:auto;
  background:#fff;
  padding:30px;
  border-radius:15px;
  box-shadow:0 5px 15px rgba(0,128,128,.1);
  opacity:0;
  transform:translateY(25px);
  transition:.6s;
}
.content.show{opacity:1;transform:none}

/* ===== CARD ===== */
.card{
  background:#f9f9f9;
  padding:20px;
  border-radius:15px;
  margin-bottom:25px;
  box-shadow:0 0 10px #00000015;
  opacity:0;
  transform:translateY(25px);
  transition:.6s;
}
.card.show{opacity:1;transform:none}

/* ===== FORM ===== */
.form-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
}
select,input{
  padding:8px 14px;
  border-radius:10px;
  border:1px solid #3a3a3a;
  font-weight:bold;
}
button{
  padding:8px 16px;
  border:none;
  border-radius:30px;
  background:linear-gradient(135deg,#1658a3,#22a5c5);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

/* ===== KPI ===== */
.kpis{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}
.kpi{
  background:linear-gradient(135deg,#1658a3bd,#22a5c5bd);
  padding:18px;
  border-radius:15px;
  text-align:center;
  font-size:12px;
  color:#ffffff;
  box-shadow:0 1px 15px rgba(0, 0, 0, 0.212);
}

/* ===== RESPONSIVE TABLE (INI SAJA YANG BARU) ===== */
.table-responsive{
  width:100%;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}
table{
  border-collapse:collapse;
  min-width:900px;
  width:100%;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
  text-align:center;
  white-space:nowrap;
}
th{
  background:#007888c4;
  color:#fff;
}

/* sticky kolom indikator */
th:first-child,
td:first-child{
  position:sticky;
  left:0;
  background:#007888c4;
  color:#fff;
  z-index:2;
}

/* ===== FOOTER ===== */
footer{
  background:#fff;
  padding:30px 20px;
  box-shadow:0 0 10px #007888c4;
}
.small{font-size:14px;color:#555}

/* ===== LOADING ===== */
.loading{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.25);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  opacity:0;
  pointer-events:none;
  transition:.3s;
}
.loading.show{opacity:1;pointer-events:auto}
.spinner{
  width:36px;height:36px;
  border:4px solid #ececec;
  border-top:4px solid var(--blue);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<header>
  <div class="logo">
    <img src="logopanjang.png">
    <a href="admin_index.html" class="admin-btn">
      <i class="fas fa-user-shield"></i> Admin Dashboard
    </a>
  </div>

  <nav>
    <ul>
      <li><a href="index.html"><i class="fas fa-home"></i> BERANDA</a></li>
      <li><a href="profil.html"><i class="fas fa-user-circle"></i> PROFIL</a></li>
      <li><a href="regulasi.html"><i class="fas fa-swatchbook"></i> REGULASI</a></li>
      <li><a href="informasi.html"><i class="fas fa-info-circle"></i> INFORMASI</a></li>
      <li><a href="layanan.html"><i class="fas fa-headset"></i> LAYANAN INTERNAL</a></li>
      <li><a href="indikator.html"><i class="fas fa-chart-line"></i> INDIKATOR</a></li>
      <li><a href="laporan.html"><i class="fa-solid fa-database"></i> LAPORAN</a></li>
      <li><a href="kunjungan.html"><i class="fas fa-database"></i> KUNJUNGAN</a></li>
      <li><a href="kegiatan.html"><i class="fas fa-calendar-check"></i> KEGIATAN</a></li>
    </ul>
  </nav>
</header>

<div class="loading" id="loading"><div class="spinner"></div></div>

<main>
<div class="content" id="wrap">

<h2>ðŸ“Š INDIKATOR MUTU (IMUT)</h2>

<div class="card">
  <div class="form-row">
    <select id="indikator" onchange="loadData(true)">
      <option value="resume">IMUT Resume Medis</option>
      <option value="dobel">IMUT Penomoran Dobel</option>
      <option value="ic">IMUT Ketidaklengkapan Informed Consent</option>
    </select>
    <select id="bulan"></select>
    <input type="number" id="tahun" value="2026">
    <button onclick="loadData(true)">Tampilkan</button>
    <button onclick="exportPDF()">ðŸ“„ Export PDF</button>
  </div>
</div>

<div class="card">
  <strong id="judul"></strong><br>
  <small><b>TIM :</b> Rekam Medik</small>
</div>

<div class="card">
  <div class="kpis">
    <div class="kpi"><h3>TARGET</h3><div id="target">25%</div></div>
    <div class="kpi"><h3>CAPAIAN</h3><div id="capaian">0%</div></div>
    <div class="kpi"><h3>KEKURANGAN TARGET</h3><div id="kurang">0%</div></div>
  </div>
</div>

<div class="card">
  <div class="table-responsive">
    <table>
      <tr id="rowTgl"><th>INDIKATOR</th></tr>
      <tr id="rowNum"><th>Numerator</th></tr>
      <tr id="rowDen"><th>Denominator</th></tr>
    </table>
  </div>
</div>

<div class="card">
  <div style="height:420px">
    <canvas id="chart"></canvas>
  </div>
</div>

<div class="card">
  <b>Numerator :</b> <span id="ketNum"></span><br>
  <b>Denominator :</b> <span id="ketDen"></span>
</div>

</div>
</main>

<footer>
<strong>MEDICAL RECORD</strong>
<div class="small">Â© 2025 RSU An'Nimah â€¢ Unit Rekam Medis</div>
</footer> 

<script>
const API="https://script.google.com/macros/s/AKfycbzFdQLezOOnH482PDq2mOEBYPMxMI2jEgRiWhU4KhaE6KUUN8cUA9X6SYfd1zZY0oEUeA/exec";
const TARGET=25;
const bln=["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"];

const chartEl = document.getElementById("chart");
const loading = document.getElementById("loading");

const info={
 resume:{judul:"IMP UNIT â€“ Ketidaklengkapan Resume Medis",num:"Resume Medis tidak lengkap",den:"Jumlah pasien"},
 dobel:{judul:"IMP UNIT â€“ Penomoran Rekam Medis Ganda",num:"RM ganda",den:"Jumlah pasien"},
 ic:{judul:"IMP UNIT â€“ Ketidaklengkapan Informed Consent",num:"IC tidak lengkap",den:"Jumlah tindakan"}
};

let chart;

bln.forEach(b=>bulan.innerHTML+=`<option>${b}</option>`);

function hari(b,t){return new Date(t,bln.indexOf(b)+1,0).getDate();}
function showLoader(v){loading.classList.toggle("show",v);}

function loadData(){
 showLoader(true);

 judul.innerText=info[indikator.value].judul;
 ketNum.innerText=info[indikator.value].num;
 ketDen.innerText=info[indikator.value].den;
 target.innerText=TARGET+"%";

 fetch(`${API}?indikator=${indikator.value}&bulan=${bulan.value}&tahun=${tahun.value}`)
 .then(r=>r.json())
 .then(r=>{
   const d=hari(bulan.value,tahun.value);
   rowTgl.innerHTML="<th>INDIKATOR</th>";
   rowNum.innerHTML="<th>Numerator</th>";
   rowDen.innerHTML="<th>Denominator</th>";

   let n=[],d2=[];
   for(let i=1;i<=d;i++){
     const x=r.data.find(v=>v.tgl==i)||{num:0,den:0};
     rowTgl.innerHTML+=`<th>${i}</th>`;
     rowNum.innerHTML+=`<td>${x.num}</td>`;
     rowDen.innerHTML+=`<td>${x.den}</td>`;
     n.push(x.num); d2.push(x.den);
   }

   const cap=r.totalDen?((r.totalNum/r.totalDen)*100):0;
   capaian.innerText=cap.toFixed(2)+"%";
   kurang.innerText=Math.max(0,cap-TARGET).toFixed(2)+"%";

   if(chart) chart.destroy();
   chart=new Chart(chartEl,{
  type:"bar",
  data:{
    labels:[...Array(d).keys()].map(i=>i+1),
    datasets:[
      {
        label:"Numerator",
        data:n,
        backgroundColor:"rgba(22,163,74,.6)",
        barPercentage:0.9,
        categoryPercentage:0.8
      },
      {
        label:"Denominator",
        data:d2,
        backgroundColor:"rgba(37,99,235,.6)",
        barPercentage:0.9,
        categoryPercentage:0.8
      }
    ]
  },
  options:{
    responsive:true,
    maintainAspectRatio:false,
    scales:{
      y:{
        beginAtZero:true
      }
    }
  }
});

   document.querySelector(".content").classList.add("show");
   document.querySelectorAll(".card").forEach((c,i)=>setTimeout(()=>c.classList.add("show"),i*120));
 })
 .catch(err=>{
   console.error(err);
   alert("Gagal memuat data IMUT");
 })
 .finally(()=>{
   showLoader(false);
 });
}

loadData();
</script> 

</body>
</html>
