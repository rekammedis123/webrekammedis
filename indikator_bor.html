<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="icon" href="logorekammedis.png">
<title>Indikator Rawat Inap - Medical Record</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{--green:#16a34a;}
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Verdana}
html,body{min-height:100vh;background:linear-gradient(135deg,#ffffff,#eeecec);display:flex;flex-direction:column;}
header {
      background: linear-gradient(150deg, #ffffff, #66a378); 
      padding: 15px 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border-bottom: 2px solid rgba(255, 255, 255, 0.808);
    }
.logo img{width:300px;height:70px}
nav ul {
      list-style: none;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      padding: 10px;
      background: linear-gradient(5deg, #ffffff, #ffffff); /* Biru pastel rumah sakit */
      border-radius: 50px;
      font-size: 13px;
      justify-content: center;
      margin-top: 15px;
      box-shadow: 0 0 10px #027e40;
    }
    nav ul li a {
      text-decoration: none;
      color: #3a3a3a;
      font-weight: bold;
      border-radius: 50px;
      padding: 5px 15px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    nav ul li a:hover {
      color: #5aa190;
      font-weight: bold;
    }
    main {
      flex: 1;
      padding: 30px 20px;
    }
    .content{
      max-width:1200px;
      margin:auto;
      background:#fff;
      padding:30px;
      border-radius:15px;
      box-shadow:0 5px 15px rgba(0,128,128,.1);
      opacity:0;
      transform:translateY(25px);
      transition:.6s ease;
    }

    .content.show{
      opacity:1;
      transform:none;
    }
h2{font-size:28px;color:#088a6e;margin-bottom:20px;display:flex;align-items:center;gap:10px;}
.card{background:#f9f9f9;padding:20px;border-radius:15px;margin-bottom:25px;box-shadow:0 0 10px #00000015;opacity:0;transform:translateY(25px);transition:.6s ease;}
.card.show{opacity:1;transform:none;}
.select-wrapper{display:flex;align-items:center;gap:12px;font-size:16px;}
.select-wrapper select{padding:8px 14px;border-radius:10px;border:1px solid #3a3a3a;font-size:16px;font-weight:bold;color:#3a3a3a;cursor:pointer;}

/* ===== ADMIN BUTTON ===== */
    .admin-btn{
      position:fixed;
      top:15px;
      right:20px;
      z-index:999;
      background:linear-gradient(135deg,#16a34a,#22c55e);
      color:#fff;
      padding:8px 16px;
      border-radius:30px;
      font-size:12px;
      text-decoration:none;
      display:flex;
      align-items:center;
      gap:8px;
      box-shadow:0 5px 15px rgba(0,0,0,.25);
      transition:.3s ease;
    }
    .admin-btn:hover{
      transform:translateY(-2px);
      box-shadow:0 8px 20px rgba(0,0,0,.3);
      background:linear-gradient(135deg,#15803d,#22c55e);
    }
    @media (max-width: 1024px) {
  .admin-btn {
    position: relative;
    top: auto;
    align-self: flex-start; 
    right: auto;
    width: fit-content;
    margin-top: 15px;
  }
  .logo {
    flex-direction: column;
    align-items: flex-start;
  }
}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#3cb371;color:#fff}
.good{background:#d4f8e8}
.warn{background:#fff3cd}
.bad{background:#f8d7da}

.dropdown-hubungi {
      position: relative;
      display: inline-block;
    }
    
    .dropdown-content-hubungi {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
      border-radius: 10px;
      overflow: hidden;
    }
    
    .dropdown-content-hubungi a {
      color: #333;
      padding: 10px 15px;
      text-decoration: none;
      display: block;
      font-size: 12px;
      transition: all 0.3s;
    }
    
    .dropdown-content-hubungi a:hover {
      background-color: #e2f8f1;
      color: #1f8664;
    }
    
    .dropdown-hubungi:hover .dropdown-content-hubungi {
      display: block;
    }

footer{background:#fff;padding:30px 20px;box-shadow:0 0 10px #027e40;}
.small{font-size:14px;color:#555}
.loading{position:fixed;inset:0;background:rgba(0,0,0,.25);display:flex;align-items:center;justify-content:center;z-index:9999;opacity:0;pointer-events:none;transition:.3s;}
.loading.show{opacity:1;pointer-events:auto;}
.spinner{width:36px;height:36px;border:4px solid #bbf7d0;border-top:4px solid var(--green);border-radius:50%;animation:spin 1s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<header>
  <div class="logo">
    <img src="logopanjang.png">
    <a href="admin_index.html" class="admin-btn"><i class="fas fa-user-shield"></i> Admin Dashboard</a>
  </div>
  <nav>
      <ul>
        <li><a href="index.html" title="Beranda"><i class="fas fa-home"></i>BERANDA</a></li></li>
        <li><a href="profil.html"><i class="fas fa-user-circle"></i> PROFIL</a></li>
        <li><a href="regulasi.html"><i class="fa-solid fa-swatchbook"></i> REGULASI</a></li>
        <li><a href="informasi.html"><i class="fas fa-info-circle"></i> INFORMASI</a></li>
        <li><a href="layanan.html"><i class="fa-solid fa-headset"></i> LAYANAN INTERNAL</a></li>
        <li><a href="indikator.html"><i class="fas fa-chart-line"></i> INDIKATOR</a></li>
        <li><a href="laporan.html"><i class="fa-solid fa-database"></i> LAPORAN</a></li>
        <li><a href="kegiatan.html"><i class="fas fa-calendar-check"></i> KEGIATAN</a></li>
        <li class="dropdown-hubungi">
          <a class="dropbtn-hubungi"><i class="fas fa-phone"></i> HUBUNGI KAMI <i class="fas fa-caret-down"></i></a>
          <div class="dropdown-content-hubungi">
            <a href="#"><i class="fas fa-envelope"></i> Email</a>
            <a href="#"><i class="fas fa-phone"></i> Telepon</a>
            <a href="https://wa.me/6283153300859"><i class="fab fa-whatsapp"></i> WhatsApp</a>
            <a href="#"><i class="fas fa-map-marker-alt"></i> Alamat</a>
          </div>
        </li>
      </ul>
    </nav>
</header>

<div class="loading" id="loading"><div class="spinner"></div></div>

<main>
<div class="content">

<h2>ðŸ“Š INDIKATOR BOR LOS TOI</h2>

<div class="card">
  <div class="select-wrapper">
    <strong>ðŸ“… Tahun</strong>
    <select id="tahun"></select>
  </div>
</div>

<div class="card">
<h3 id="judulTabel"></h3>
<table id="tabelExport">
<thead>
<tr>
<th>Bulan</th><th>TT</th><th>HP</th><th>BOR</th><th>LOS</th><th>TOI</th><th>BTO</th>
</tr>
</thead>
<tbody id="tabelData"></tbody>
</table>
</div>

<div class="card">
<h3 id="judulGrafik"></h3>
<div style="height:420px">
  <canvas id="chartCanvas"></canvas>
</div>
</div>

</div>
</main>

<footer>
<strong>MEDICAL RECORD</strong>
<div class="small">Â© 2025 RSU An'Nimah â€¢ Unit Rekam Medis</div>
</footer>

<script>
const loading=document.getElementById("loading");
const cards=document.querySelectorAll(".card");
const tahun=document.getElementById("tahun");
const chartEl=document.getElementById("chartCanvas");

const API_URL="https://script.google.com/macros/s/AKfycbyS6F1g4_EA2pdQywCymutFVjcAWhD0qoZGVkrACZPC97cENoWdh7r6vWQ7DihV14XD/exec";
const bulan=["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"];
const TARGET={BOR:[60,85],LOS:[6,9],TOI:[1,3],BTO:[40,999]};
let chart;

function f2(v){return v?Number(v).toFixed(2):"0.00";}
function showLoader(v){loading.classList.toggle("show",v);}
function showCards(){cards.forEach((c,i)=>setTimeout(()=>c.classList.add("show"),i*120));}

(function(){
  const now=new Date().getFullYear();
  for(let y=2020;y<=now+1;y++){
    const o=document.createElement("option");
    o.value=y;o.textContent=y;
    if(y===now)o.selected=true;
    tahun.appendChild(o);
  }
})();

function getClass(v,[min,max]){
  if(v<min)return"bad";
  if(v>max)return"warn";
  return"good";
}

function loadData(){
  showLoader(true);
  fetch(API_URL+"?tahun="+tahun.value)
  .then(r=>r.json())
  .then(d=>{
    let html="",bor=[],los=[],toi=[],bto=[];
    bulan.forEach(b=>{
      const x=d.find(i=>i.bulan===b)||{};
      html+=`
      <tr>
        <td>${b}</td>
        <td>${x.tt||0}</td>
        <td>${x.hp||0}</td>
        <td class="${getClass(x.bor||0,TARGET.BOR)}">${f2(x.bor)}</td>
        <td class="${getClass(x.los||0,TARGET.LOS)}">${f2(x.los)}</td>
        <td class="${getClass(x.toi||0,TARGET.TOI)}">${f2(x.toi)}</td>
        <td class="${getClass(x.bto||0,TARGET.BTO)}">${f2(x.bto)}</td>
      </tr>`;
      bor.push(x.bor||0); los.push(x.los||0); toi.push(x.toi||0); bto.push(x.bto||0);
    });
    tabelData.innerHTML=html;

    if(chart) chart.destroy();
    chart=new Chart(chartEl,{
      data:{
        labels:bulan,
        datasets:[
          {type:"bar",label:"BOR (%)",data:bor,backgroundColor:"rgba(22,163,74,.6)",yAxisID:"y"},
          {type:"line",label:"LOS",data:los,borderColor:"#2563eb",yAxisID:"y1",tension:.3},
          {type:"line",label:"TOI",data:toi,borderColor:"#dc2626",yAxisID:"y1",tension:.3},
          {type:"line",label:"BTO",data:bto,borderColor:"#ca8a04",yAxisID:"y1",tension:.3}
        ]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        scales:{
          y:{min:0,max:100,title:{display:true,text:"BOR (%)"}},
          y1:{position:"right",grid:{drawOnChartArea:false},title:{display:true,text:"LOS / TOI / BTO"}}
        }
      }
    });

    judulTabel.innerText="ðŸ“‹ Rekap Tahun "+tahun.value;
    judulGrafik.innerText="ðŸ“ˆ Grafik Tahun "+tahun.value;
    showLoader(false);
    showCards();
    const content=document.querySelector(".content");
    content.classList.add("show");
    setTimeout(showCards,200);
  });
}

tahun.onchange=loadData;
loadData();
</script>

</body>
</html>
