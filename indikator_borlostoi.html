<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="icon" href="logorekammedis.png" type="image/png">
<title>Indikator - Medical Record</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Verdana}
html,body{
  min-height:100vh;
  background:linear-gradient(135deg,#fff,#eeecec);
  display:flex;
  flex-direction:column;
}

/* ===== HEADER SAMA PERSIS ===== */
header{
  background:linear-gradient(150deg,#fff,#66a378);
  padding:15px 20px;
  box-shadow:0 2px 10px rgba(0,0,0,.1);
  border-bottom:2px solid rgba(255,255,255,.8);
}
.logo{display:flex;align-items:center}
.logo img{width:300px;height:70px}
.user-info{text-align:right;font-size:13px;color:#fff;margin-top:10px}

nav ul{
  list-style:none;
  display:flex;
  flex-wrap:wrap;
  gap:5px;
  padding:10px;
  background:#fff;
  border-radius:50px;
  justify-content:center;
  margin-top:15px;
  box-shadow:0 0 10px #027e40;
}
nav ul li a{
  text-decoration:none;
  color:#3a3a3a;
  font-weight:bold;
  border-radius:50px;
  padding:5px 15px;
  display:flex;
  align-items:center;
  gap:5px;
}
nav ul li a:hover{color:#5aa190}

.dropdown-hubungi{position:relative}
.dropdown-content-hubungi{
  display:none;
  position:absolute;
  background:#f9f9f9;
  min-width:160px;
  box-shadow:0 8px 16px rgba(0,0,0,.2);
  border-radius:10px;
  overflow:hidden;
  z-index:99;
}
.dropdown-content-hubungi a{
  padding:10px 15px;
  font-size:12px;
  display:block;
  color:#333;
}
.dropdown-content-hubungi a:hover{
  background:#e2f8f1;
  color:#1f8664;
}
.dropdown-hubungi:hover .dropdown-content-hubungi{display:block}

/* ===== MAIN ===== */
main{flex:1;padding:30px 20px}

.content-container{
  max-width:1200px;
  margin:auto;
  background:#fff;
  padding:30px;
  border-radius:15px;
  box-shadow:0 5px 15px rgba(0,128,128,.1);
  opacity:0;
  transform:scale(.98);
  animation:fadeIn .4s ease forwards;
}
@keyframes fadeIn{to{opacity:1;transform:scale(1)}}

h2{color:#008080;margin-bottom:20px}

.card{
  background:#f9f9f9;
  padding:20px;
  border-radius:12px;
  margin-bottom:25px;
}

.fade{opacity:0;transition:.25s}

/* ===== TABLE ===== */
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#3cb371;color:#fff}
input,select{width:100%;padding:5px;border-radius:5px;border:1px solid #bbb}

/* ===== BUTTON ===== */
.btn{
  padding:10px 24px;
  background:#009765;
  color:#fff;
  border:none;
  border-radius:50px;
  font-weight:bold;
  cursor:pointer;
}
.btn.loading{background:#999}

/* ===== FOOTER SAMA PERSIS ===== */
footer{
  background:#fff;
  display:flex;
  justify-content:space-between;
  padding:30px 20px;
  font-size:18px;
  box-shadow:0 0 10px #027e40;
}
.small{font-size:14px;color:#555}

/* loader */
#loader{
  position:fixed;
  inset:0;
  background:rgba(255,255,255,.6);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
  color:#009765;
  z-index:999;
  opacity:0;
  pointer-events:none;
  transition:.25s;
}
#loader.show{opacity:1;pointer-events:auto}
</style>
</head>

<body>

<div id="loader">
  <i class="fas fa-spinner fa-spin"></i>&nbsp; Memuat data...
</div>

<header>
  <div class="logo">
    <img src="logopanjang.png">
  </div>
  <div class="user-info"></div>
  <nav>
    <ul>
      <li><a href="index.html"><i class="fas fa-home"></i> BERANDA</a></li>
      <li><a href="profil.html"><i class="fas fa-user-circle"></i> PROFIL</a></li>
      <li><a href="regulasi.html"><i class="fas fa-swatchbook"></i> REGULASI</a></li>
      <li><a href="informasi.html"><i class="fas fa-info-circle"></i> INFORMASI</a></li>
      <li><a href="layanan.html"><i class="fas fa-headset"></i> LAYANAN INTERNAL</a></li>
      <li><a href="indikator.html"><i class="fas fa-chart-line"></i> INDIKATOR</a></li>
      <li><a href="laporan.html"><i class="fas fa-database"></i> LAPORAN</a></li>
      <li><a href="kegiatan.html"><i class="fas fa-calendar-check"></i> KEGIATAN</a></li>
      <li class="dropdown-hubungi">
        <a><i class="fas fa-phone"></i> HUBUNGI KAMI <i class="fas fa-caret-down"></i></a>
        <div class="dropdown-content-hubungi">
          <a href="#"><i class="fas fa-envelope"></i> Email</a>
          <a href="#"><i class="fas fa-phone"></i> Telepon</a>
          <a href="https://wa.me/6283153300859"><i class="fab fa-whatsapp"></i> WhatsApp</a>
          <a href="#"><i class="fas fa-map-marker-alt"></i> Alamat</a>
        </div>
      </li>
    </ul>
  </nav>
</header>

<main>
<div class="content-container">

<h2>ðŸ“Š Indikator Rawat Inap</h2>

<div class="card">
<strong>Tahun:</strong>
<select id="tahun">
<option>2025</option>
<option>2026</option>
</select>
</div>

<div class="card">
<h3>Input Data 12 Bulan</h3><br>
<table id="inputTable">
<thead>
<tr>
<th>Bulan</th><th>TT</th><th>HP</th><th>BOR</th><th>LOS</th><th>TOI</th><th>BTO</th>
</tr>
</thead>
<tbody></tbody>
</table><br>
<button class="btn" id="btnSimpan">ðŸ’¾ Simpan Data</button>
</div>

<div class="card fade" id="cardTabel">
<h3 id="judulTabel"></h3>
<table>
<thead>
<tr>
<th>Bulan</th><th>TT</th><th>HP</th><th>BOR</th><th>LOS</th><th>TOI</th><th>BTO</th>
</tr>
</thead>
<tbody id="tabelData"></tbody>
</table>
</div>

<div class="card fade" id="cardGrafik">
<h3 id="judulGrafik"></h3>
<div style="height:420px"><canvas id="chart"></canvas></div>
</div>

</div>
</main>

<footer>
  <div>
    <strong>MEDICAL RECORD</strong><br>
    <div class="small">Â© 2025 RSU An'Nimah â€¢ Unit Rekam Medis</div>
  </div>
</footer>


<script>
const URL="https://script.google.com/macros/s/AKfycbwT-X3FTiCNqz97_UcCgbeZylbA0bhT52mZxZ6hkOgahQsN7cXWuusopyml0i9STObf/exec";

const bulanList=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
const tbodyInput=document.querySelector("#inputTable tbody");

bulanList.forEach(b=>{
tbodyInput.innerHTML+=`
<tr>
<td><strong>${b}</strong></td>
<td><input type="number" data-bulan="${b}" data-field="tt"></td>
<td><input type="number" data-bulan="${b}" data-field="hp"></td>
<td><input type="number" step="0.01" data-bulan="${b}" data-field="bor"></td>
<td><input type="number" step="0.01" data-bulan="${b}" data-field="los"></td>
<td><input type="number" step="0.01" data-bulan="${b}" data-field="toi"></td>
<td><input type="number" step="0.01" data-bulan="${b}" data-field="bto"></td>
</tr>`;
});

let chart;
btnSimpan.onclick=simpanSemua;

function getVal(v){
  return parseFloat(String(v||0).replace(",", "."))||0;
}

function showLoader(v=true){
  loader.classList.toggle("show",v);
}

function simpanSemua(){
btnSimpan.classList.add("loading");
btnSimpan.innerHTML='<i class="fa fa-spinner fa-spin"></i> Menyimpan...';

const th=tahun.value;
const data=[];

bulanList.forEach(b=>{
const obj={tahun:th,bulan:b};
document.querySelectorAll(`[data-bulan="${b}"]`).forEach(i=>{
obj[i.dataset.field]=getVal(i.value);
});
data.push(obj);
});

fetch(URL,{method:"POST",body:JSON.stringify({bulk:true,data})})
.then(()=>loadData())
.finally(()=>{
btnSimpan.classList.remove("loading");
btnSimpan.innerHTML="ðŸ’¾ Simpan Data";
});
}

function loadData(){
showLoader(true);
cardTabel.classList.add("fade");
cardGrafik.classList.add("fade");

fetch(URL+"?tahun="+tahun.value)
.then(r=>r.json())
.then(data=>{
let tbody="";
const bor=[],los=[],toi=[],bto=[];

bulanList.forEach(b=>{
const d=data.find(x=>x.bulan===b)||{};
tbody+=`
<tr>
<td>${b}</td>
<td>${d.tt||0}</td><td>${d.hp||0}</td>
<td>${d.bor||0}</td><td>${d.los||0}</td>
<td>${d.toi||0}</td><td>${d.bto||0}</td>
</tr>`;
bor.push(d.bor||0);los.push(d.los||0);toi.push(d.toi||0);bto.push(d.bto||0);
});

tabelData.innerHTML=tbody;

if(chart)chart.destroy();
chart=new Chart(chartEl,{
data:{
labels:bulanList,
datasets:[
{type:"bar",label:"BOR (%)",data:bor},
{type:"line",label:"LOS",data:los},
{type:"line",label:"TOI",data:toi},
{type:"line",label:"BTO",data:bto}
]
},
options:{responsive:true,maintainAspectRatio:false}
});

setTimeout(()=>{
cardTabel.classList.remove("fade");
cardGrafik.classList.remove("fade");
showLoader(false);
},200);
});
}

const chartEl=document.getElementById("chart");
tahun.addEventListener("change",loadData);
loadData();
</script> 

</body>
</html>
