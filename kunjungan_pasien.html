<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="icon" href="logorekammedis.png">
<title>Kunjungan Pasien - Medical Record</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{--green:#16a34a;}
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,Verdana}
html,body{min-height:100vh;background:linear-gradient(135deg,#ffffff,#eeecec);display:flex;flex-direction:column;}

header{
  background:linear-gradient(150deg,#ffffff,#66a378);
  padding:15px 20px;
  box-shadow:0 2px 10px rgba(0,0,0,.1);
  border-bottom:2px solid rgba(255,255,255,.8);
}
.logo img{width:300px;height:70px}

nav ul{
  list-style:none;
  display:flex;
  flex-wrap:wrap;
  gap:5px;
  padding:10px;
  background:#fff;
  border-radius:50px;
  font-size:13px;
  justify-content:center;
  margin-top:15px;
  box-shadow:0 0 10px #027e40;
}
nav ul li a{
  text-decoration:none;
  color:#3a3a3a;
  font-weight:bold;
  border-radius:50px;
  padding:5px 15px;
  display:flex;
  align-items:center;
  gap:5px;
  transition:.3s;
}
nav ul li a:hover{color:#5aa190}

main{flex:1;padding:30px 20px}

.content{
  max-width:1200px;
  margin:auto;
  background:#fff;
  padding:30px;
  border-radius:15px;
  box-shadow:0 5px 15px rgba(0,128,128,.1);
  opacity:0;
  transform:translateY(25px);
  transition:.6s;
}
.content.show{opacity:1;transform:none}

h2{
  font-size:28px;
  color:#088a6e;
  margin-bottom:20px;
  display:flex;
  align-items:center;
  gap:10px;
}

.card{
  background:#f9f9f9;
  padding:20px;
  border-radius:15px;
  margin-bottom:25px;
  box-shadow:0 0 10px #00000015;
  opacity:0;
  transform:translateY(25px);
  transition:.6s;
}
.card.show{opacity:1;transform:none}

.select-wrapper{
  display:flex;
  align-items:center;
  gap:12px;
  font-size:16px;
}
.select-wrapper select{
  padding:8px 14px;
  border-radius:10px;
  border:1px solid #3a3a3a;
  font-weight:bold;
  cursor:pointer;
}

/* ADMIN BUTTON */
.admin-btn{
  position:fixed;
  top:15px;
  right:20px;
  z-index:999;
  background:linear-gradient(135deg,#16a34a,#22c55e);
  color:#fff;
  padding:8px 16px;
  border-radius:30px;
  font-size:12px;
  text-decoration:none;
  display:flex;
  align-items:center;
  gap:8px;
  box-shadow:0 5px 15px rgba(0,0,0,.25);
  transition:.3s;
}
.admin-btn:hover{
  transform:translateY(-2px);
  background:linear-gradient(135deg,#15803d,#22c55e);
}

table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#3cb371;color:#fff}

footer{
  background:#fff;
  padding:30px 20px;
  box-shadow:0 0 10px #027e40;
}
.small{font-size:14px;color:#555}

.loading{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.25);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  opacity:0;
  pointer-events:none;
  transition:.3s;
}
.loading.show{opacity:1;pointer-events:auto}
.spinner{
  width:36px;height:36px;
  border:4px solid #bbf7d0;
  border-top:4px solid var(--green);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<header>
  <div class="logo">
    <img src="logopanjang.png">
    <a href="admin_index.html" class="admin-btn">
      <i class="fas fa-user-shield"></i> Admin Dashboard
    </a>
  </div>

  <nav>
    <ul>
      <li><a href="index.html"><i class="fas fa-home"></i> BERANDA</a></li>
      <li><a href="profil.html"><i class="fas fa-user-circle"></i> PROFIL</a></li>
      <li><a href="regulasi.html"><i class="fas fa-swatchbook"></i> REGULASI</a></li>
      <li><a href="informasi.html"><i class="fas fa-info-circle"></i> INFORMASI</a></li>
      <li><a href="layanan.html"><i class="fas fa-headset"></i> LAYANAN INTERNAL</a></li>
      <li><a href="indikator.html"><i class="fas fa-chart-line"></i> INDIKATOR</a></li>
      <li><a href="kunjungan.html"><i class="fas fa-database"></i> KUNJUNGAN</a></li>
      <li><a href="kegiatan.html"><i class="fas fa-calendar-check"></i> KEGIATAN</a></li>
    </ul>
  </nav>
</header>

<div class="loading" id="loading"><div class="spinner"></div></div>

<main>
<div class="content">

<h2>ðŸ“Š KUNJUNGAN PASIEN</h2>

<div class="card">
  <div class="select-wrapper">
    <strong>ðŸ“… Tahun</strong>
    <select id="tahun"></select>
  </div>
</div>

<div class="card">
<h3 id="judulTabel"></h3>
<table>
<thead>
<tr>
  <th>Bulan</th>
  <th>Rawat Jalan</th>
  <th>Rawat Inap</th>
  <th>IGD</th>
  <th>Total</th>
</tr>
</thead>
<tbody id="tabelData"></tbody>
</table>
</div>

<div class="card">
<h3 id="judulGrafik"></h3>
<div style="height:420px">
  <canvas id="chartCanvas"></canvas>
</div>
</div>

</div>
</main>

<footer>
<strong>MEDICAL RECORD</strong>
<div class="small">Â© 2025 RSU An'Nimah â€¢ Unit Rekam Medis</div>
</footer>

<script>
const loading=document.getElementById("loading");
const cards=document.querySelectorAll(".card");
const tahun=document.getElementById("tahun");
const tabelData=document.getElementById("tabelData");
const chartEl=document.getElementById("chartCanvas");

const API_URL="https://script.google.com/macros/s/AKfycbz833hLYkNk5v4_Bi1OD-XZBWcpG5k9jUKRh1Zti9gpB31b3QPgN0Y3cTKn5FL-6WSV/exec";
const bulan=["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"];
let chart;

function showLoader(v){loading.classList.toggle("show",v);}
function showCards(){cards.forEach((c,i)=>setTimeout(()=>c.classList.add("show"),i*120));}

(function(){
  const now=new Date().getFullYear();
  for(let y=2020;y<=now+1;y++){
    const o=document.createElement("option");
    o.value=y;o.textContent=y;
    if(y===now)o.selected=true;
    tahun.appendChild(o);
  }
})();

function loadData(){
  showLoader(true);

  fetch(API_URL+"?tahun="+tahun.value)
  .then(r=>r.json())
  .then(d=>{
    let html="", rj=[], ri=[], igd=[], total=[];

    bulan.forEach(b=>{
      const x=d.find(i=>i.bulan===b)||{};
      html+=`
      <tr>
        <td>${b}</td>
        <td>${x.rj||0}</td>
        <td>${x.ri||0}</td>
        <td>${x.igd||0}</td>
        <td><b>${x.total||0}</b></td>
      </tr>`;
      rj.push(x.rj||0);
      ri.push(x.ri||0);
      igd.push(x.igd||0);
      total.push(x.total||0);
    });

    tabelData.innerHTML=html;

    if(chart) chart.destroy();
    chart=new Chart(chartEl,{
            data:{
                labels:bulan,
                datasets:[
        {
            type:"bar",
            label:"Rawat Jalan",
            data:rj,
            backgroundColor:"rgba(22,163,74,.6)", 
            yAxisID:"y",
            borderRadius:1,
            order:1
        },
        {
            type:"bar",
            label:"Rawat Inap",
            data:ri,
            backgroundColor:"rgba(37,99,235,.6)", 
            yAxisID:"y",
            borderRadius:1,
            order:1
        },
        {
            type:"bar",
            label:"IGD",
            data:igd,
            backgroundColor:"rgba(220,38,38,.6)", 
            yAxisID:"y",
            borderRadius:1,
            order:1
        },
        {
            type:"line",
            label:"Total Kunjungan",
            data:total,
            borderColor:"#ca8a04",    
            tension:0.3,
            yAxisID:"y1",
            order:2,
            }
        ]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        scales:{
          y:{
            beginAtZero:true,
            title:{display:true,text:"Jumlah Pasien"}
          },
          y1:{
            position:"right",
            grid:{ drawOnChartArea:false },
            title:{display:true,text:"Total"}
          }
        }
      }
    });

    judulTabel.innerText="ðŸ“‹ Rekap Tahun "+tahun.value;
    judulGrafik.innerText="ðŸ“ˆ Grafik Tahun "+tahun.value;
    showLoader(false);
    document.querySelector(".content").classList.add("show");
    showCards();
  });
}

tahun.onchange=loadData;
loadData();
</script>

</body>
</html>
