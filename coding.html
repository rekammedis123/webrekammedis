<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manajemen ICD | Medical Record</title>
<link rel="icon" href="logorekammedis.ico">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{
  --green:#2fa36b;
  --green-dark:#1f7f53;
  --bg:#eef5f2;
  --card:#fff;
  --shadow:0 12px 30px rgba(0,0,0,.12);
}
*{box-sizing:border-box;font-family:'Segoe UI',Arial}
body{margin:0;background:var(--bg);min-height:100vh;display:flex;flex-direction:column}

header{background:linear-gradient(135deg,#fff,#e9f7f0);padding:15px 20px;box-shadow:var(--shadow)}
.logo img{width:300px;height:70px}

nav ul{
  list-style:none;display:flex;gap:6px;justify-content:center;
  background:#fff;padding:10px;border-radius:50px;
  box-shadow:var(--shadow);flex-wrap:wrap;margin-top:15px
}
nav a{
  text-decoration:none;color:#444;font-weight:600;font-size:14px;
  padding:6px 16px;border-radius:50px;display:flex;gap:6px
}
nav a:hover{background:linear-gradient(135deg,var(--green),var(--green-dark));color:#fff}

main{flex:1;padding:40px 20px}
.container{max-width:1200px;margin:auto}

.card{
  background:#fff;border-radius:22px;padding:30px;
  box-shadow:var(--shadow);margin-bottom:30px
}
.card h2{color:var(--green);margin-bottom:20px}

.form-grid{
  display:grid;
  grid-template-columns:1fr 1fr 2fr 2fr auto;
  gap:12px
}
.form-grid select,
.form-grid input{
  padding:10px 14px;
  border-radius:12px;
  border:1px solid #ccc;
  font-size:14px
}
.btn{
  background:linear-gradient(135deg,var(--green),var(--green-dark));
  color:#fff;border:none;
  padding:12px 22px;border-radius:30px;
  font-weight:600;cursor:pointer
}
.logo{
  display:flex;
  align-items:center;
  gap:15px;
  flex-wrap:wrap;
}
.logo img{width:300px;height:70px}
/* ADMIN */
.admin-btn{
  margin-left:auto;
  background:linear-gradient(135deg,var(--green),var(--green-dark));
  color:#fff;
  padding:8px 18px;
  border-radius:30px;
  font-size:12px;
  text-decoration:none;
  display:flex;
  align-items:center;
  gap:8px;
  box-shadow:var(--shadow);
  transition:.3s;
}
.admin-btn:hover{transform:translateY(-2px)}

/* DROPDOWN */
.dropdown-hubungi{position:relative}
.dropdown-content-hubungi{
  display:none;
  position:absolute;
  background:#fff;
  min-width:180px;
  border-radius:14px;
  box-shadow:var(--shadow);
  overflow:hidden;
  z-index:9;
}
.dropdown-content-hubungi a{
  padding:10px 15px;
  display:block;
  font-size: 14px;
  color:#333;
  text-decoration:none;
}
.dropdown-content-hubungi a:hover{
  background:#e9f7f0;
  color:var(--green-dark);
}
.dropdown-hubungi:hover .dropdown-content-hubungi{display:block}

/* LOADING */
.loading-overlay{
  position:fixed;
  inset:0;
  background:rgba(255,255,255,.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.spinner{
  width:36px;height:36px;
  border:4px solid #ececec;
  border-top:4px solid var(--green);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
/* FILTER BAR */
.filter-bar{
  display:flex;
  gap:10px;
  margin-bottom:15px;
  flex-wrap:wrap
}
.filter-bar select,
.filter-bar input{
  padding:10px 14px;
  border-radius:12px;
  border:1px solid #ccc;
  font-size:14px;
  flex:1
}

table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #eee;font-size:14px}
th{background:#f3fbf7;color:var(--green-dark);text-align:left}
td button{border:none;background:none;cursor:pointer;font-size:16px}

footer{
  background:#fff;
  padding:30px 20px;
  box-shadow:var(--shadow);
}
.small{font-size:14px;color:#666}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1}
}

@media(max-width:900px){
  .hero-grid{grid-template-columns:1fr}
}
</style>
</head>

<body>
<div class="loading-overlay" id="loading">
  <div class="spinner"></div>
</div>
<header>
  <div class="logo">
    <img src="logopanjang.png">
    <a href="admin_index.html" class="admin-btn">
      <i class="fas fa-user-shield"></i> Admin Dashboard
    </a>
  </div>

  <nav>
    <ul>
      <li><a href="index.html"><i class="fas fa-home"></i> BERANDA</a></li>
      <li><a href="profil.html"><i class="fas fa-user-circle"></i> PROFIL</a></li>
      <li><a href="regulasi.html"><i class="fas fa-swatchbook"></i> REGULASI</a></li>
      <li><a href="informasi.html"><i class="fas fa-info-circle"></i> INFORMASI</a></li>
      <li><a href="layanan.html"><i class="fas fa-headset"></i> LAYANAN INTERNAL</a></li>
      <li><a href="indikator.html"><i class="fas fa-chart-line"></i> INDIKATOR</a></li>
      <li><a href="laporan.html"><i class="fas fa-database"></i> LAPORAN</a></li>
      <li><a href="kegiatan.html"><i class="fas fa-calendar-check"></i> KEGIATAN</a></li>
      <li class="dropdown-hubungi">
          <a class="dropbtn-hubungi"><i class="fas fa-phone"></i> HUBUNGI KAMI <i class="fas fa-caret-down"></i></a>
          <div class="dropdown-content-hubungi">
            <a href="#"><i class="fas fa-envelope"></i> Email</a>
            <a href="#"><i class="fas fa-phone"></i> Telepon</a>
            <a href="https://wa.me/6283153300859"><i class="fab fa-whatsapp"></i> WhatsApp</a>
            <a href="#"><i class="fas fa-map-marker-alt"></i> Alamat</a>
          </div>
        </li>
    </ul>
  </nav>
</header>

<main>
<div class="container">

<!-- INPUT ICD -->
<div class="card">
<h2><i class="fas fa-pen"></i> Input ICD</h2>
<div class="form-grid">
  <select id="jenis">
    <option value="icd10">ICD 10</option>
    <option value="icd9">ICD 9</option>
    <option value="mcu">MCU</option>
  </select>
  <input id="kode" placeholder="Kode ICD">
  <input id="deskripsi" placeholder="Deskripsi">
  <input id="catatan" placeholder="Catatan / Keterangan">
  <button class="btn" onclick="tambahICD()">Simpan</button>
</div>
</div>

<!-- DAFTAR ICD -->
<div class="card">
<h2>Daftar ICD</h2>

<div class="filter-bar">
  <select id="filterJenis" onchange="render()">
    <option value="">Semua ICD</option>
    <option value="icd10">ICD 10</option>
    <option value="icd9">ICD 9</option>
    <option value="mcu">MCU</option>
  </select>
  <input placeholder="Cari kode / deskripsi / catatan..."
         onkeyup="cari(this)">
</div>

<table>
<thead>
<tr>
  <th>Jenis</th>
  <th>Kode</th>
  <th>Deskripsi</th>
  <th>Catatan</th>
  <th>Aksi</th>
</tr>
</thead>
<tbody id="data"></tbody>
</table>
</div>

</div>
</main>

<footer>
<strong>MEDICAL RECORD</strong>
<div class="small">¬© 2025 RSU An'Nimah ‚Ä¢ Unit Rekam Medis</div>
</footer>

<script>
const API = "https://script.google.com/macros/s/AKfycbxcEbM21ukfQtnW2yipXqTmUbhs4ylye6wXogiWTp9eS10HVc_WIzeNVHlD_13Gqzg/exec";

const loading = document.getElementById("loading");
let dataICD = [];
let keyword = "";
let editIndex = null;

window.onload = loadData;

function loadData(){
  loading.style.display="flex";
  fetch(API+"?action=get")
    .then(r => r.json())
    .then(d => {
      dataICD = d;
      editIndex = null;
      render();
    })
    .finally(() => loading.style.display="none");
}

function render(){
  const tb = document.getElementById("data");
  const jenisFilter = document.getElementById("filterJenis").value;
  tb.innerHTML="";

  dataICD.forEach((r,i)=>{
    const text = ((r[1]||"")+(r[2]||"")+(r[3]||"")).toLowerCase();
    if(keyword && !text.includes(keyword)) return;
    if(jenisFilter && r[0] !== jenisFilter) return;

    // MODE EDIT
    if(editIndex === i){
      tb.innerHTML += `
      <tr>
        <td>${r[0].toUpperCase()}</td>
        <td><input id="ekode" value="${r[1]}" style="width:100%"></td>
        <td><input id="edesk" value="${r[2]}" style="width:100%"></td>
        <td><input id="ecat" value="${r[3]||""}" style="width:100%"></td>
        <td>
          <button onclick="simpanEdit(${i})">üíæ</button>
          <button onclick="batalEdit()">‚ùå</button>
        </td>
      </tr>`;
    } 
    // MODE NORMAL
    else {
      tb.innerHTML += `
      <tr>
        <td>${r[0].toUpperCase()}</td>
        <td>${r[1]}</td>
        <td>${r[2]}</td>
        <td>${r[3]||""}</td>
        <td>
          <button onclick="mulaiEdit(${i})">‚úèÔ∏è</button>
          <button onclick="hapusICD('${r[1]}')">üóëÔ∏è</button>
        </td>
      </tr>`;
    }
  });
}

function mulaiEdit(i){
  editIndex = i;
  render();
}

function batalEdit(){
  editIndex = null;
  render();
}

function simpanEdit(i){
  const r = dataICD[i];
  const kode = document.getElementById("ekode").value;
  const desk = document.getElementById("edesk").value;
  const cat  = document.getElementById("ecat").value;

  if(!kode || !desk){
    alert("Kode & Deskripsi wajib diisi");
    return;
  }

  loading.style.display="flex";
  fetch(`${API}?action=update&oldkode=${r[1]}&jenis=${r[0]}&kode=${kode}&deskripsi=${desk}&catatan=${cat}`)
    .then(()=>loadData());
}

function cari(el){
  keyword = el.value.toLowerCase();
  render();
}

function tambahICD(){
  loading.style.display="flex";
  fetch(`${API}?action=add&jenis=${jenis.value}&kode=${kode.value}&deskripsi=${deskripsi.value}&catatan=${catatan.value}`)
    .then(()=>loadData());

  kode.value="";
  deskripsi.value="";
  catatan.value="";
}

function hapusICD(kode){
  if(!confirm("Hapus ICD ini?")) return;
  loading.style.display="flex";
  fetch(`${API}?action=delete&kode=${kode}`)
    .then(()=>loadData());
}
</script>


</body>
</html>
